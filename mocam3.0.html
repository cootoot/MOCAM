<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MOCAM</title>
    
    <!-- iOS Web App 配置 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="MOCAM">
    
    <!-- 添加启动屏样式 -->
    <style>
        /* 防止页面弹性滚动 */
        html, body {
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
            overscroll-behavior: none;
        }
        
        /* 适配刘海屏 */
        @supports (padding-top: env(safe-area-inset-top)) {
            .camera-container {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
            
            .controls {
                padding-bottom: env(safe-area-inset-bottom);
                height: calc(120px + env(safe-area-inset-bottom));
            }
            
            .action-buttons {
                bottom: calc(30px + env(safe-area-inset-bottom));
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #000;
            color: #fff;
        }

        .camera-container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: #1a1a1a;
            font-family: "LCD", monospace;
            padding: 40px 0 0 0;
            position: relative;
            overflow: hidden;
        }

        /* 添加顶部状态栏 */
        .camera-status {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: #141414;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .camera-status .left-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .camera-status .right-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .status-icon {
            width: 16px;
            height: 16px;
            opacity: 0.7;
        }

        .viewfinder {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: #000;
            border: 1px solid #222;
            max-width: 80%;
            max-height: calc(100vh - 240px);
            margin: 0 auto;
            border-radius: 4px;
            margin-top: 0;
            margin-bottom: 140px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        /* 添加取景框角标 */
        .viewfinder::before,
        .viewfinder::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            z-index: 6;
        }
        
        .viewfinder::before {
            top: 10px;
            left: 10px;
            border-right: none;
            border-bottom: none;
        }
        
        .viewfinder::after {
            bottom: 10px;
            right: 10px;
            border-left: none;
            border-top: none;
        }

        /* 添加相机信息显示 */
        .camera-info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            text-transform: uppercase;
            z-index: 6;
            text-shadow: 0 0 2px rgba(255, 255, 255, 0.3);
            letter-spacing: 1px;
        }
        
        .camera-settings {
            position: absolute;
            top: 10px;
            right: 10px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            text-transform: uppercase;
            z-index: 6;
            text-shadow: 0 0 2px rgba(255, 255, 255, 0.3);
            letter-spacing: 1px;
        }

        #camera-view {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform-origin: center center;
            transition: transform 0.3s ease-out;
            border-radius: 6px;
        }

        .controls {
            height: 120px;
            padding: 20px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            background-color: #141414;
            position: fixed;
            z-index: 10;
            border-top: 1px solid #222;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
        }

        .camera-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .flip-btn {
            width: 40px;
            height: 40px;
            background: #1a1a1a;
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            cursor: pointer;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.2s ease;
        }

        .flip-btn:active {
            background: #222;
            transform: scale(0.95);
        }

        .shutter-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background-color: #1a1a1a;
            border: 2px solid #333;
            cursor: pointer;
            position: relative;
            z-index: 11;
            transition: all 0.2s ease;
        }

        .shutter-btn:active {
            background-color: #222;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .filter-btn {
            padding: 8px 15px;
            background: transparent;
            color: white;
            border: 1px solid white;
            border-radius: 20px;
            margin: 0 5px;
        }

        .camera-settings {
            display: flex;
            gap: 20px;
        }

        .setting-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: transparent;
            border: 1px solid white;
            color: white;
            font-size: 20px;
        }

        /* 添加滤镜预设样式 */
        .filter-nomo {
            filter: contrast(1.1) saturate(1.1) sepia(0.2) brightness(0.95);
        }

        .filter-film {
            filter: contrast(1.2) saturate(0.8) sepia(0.15) brightness(1.1) hue-rotate(5deg);
        }

        .filter-bw {
            filter: grayscale(1) contrast(1.2) brightness(1.1);
        }

        .filter-vintage {
            filter: sepia(0.4) contrast(1.1) brightness(0.9) saturate(0.8);
        }

        .filter-fade {
            filter: brightness(1.1) contrast(0.9) saturate(0.8) sepia(0.1);
        }

        .filter-chrome {
            filter: contrast(1.3) brightness(0.9) saturate(1.2) hue-rotate(-10deg);
        }

        .filter-warm {
            filter: sepia(0.3) contrast(1.1) brightness(1.05) saturate(1.2) hue-rotate(10deg);
        }

        .filter-cool {
            filter: sepia(0.2) contrast(1.1) brightness(1) saturate(0.9) hue-rotate(-10deg);
        }

        /* 添加激活状态的滤镜按钮样式 */
        .filter-btn.active {
            background: rgba(255, 255, 255, 0.2);
            border-color: #fff;
        }

        /* 添加胶片颗粒效果 */
        .grain-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyBAMAAADsEZWCAAAAGFBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVNDCqAAAACHRSTlMzMzMzMzMzM85JBgUAAAABYktHRAH/Ai3eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4QMPByYnB2sQJQAAAFpJREFUOMtjYBgFgwwwKkhKSgoaSkhICBqKiooKGgoICAgaCggICAoyMDAIMTAwCDI0NDQwNDY2MjQ0NDYyNDQ0NDA0NDQwMDAwMDAwMDAwMDAyMjIyMqKxhwYAAIdkg7vR8h0AAAAASUVORK5CYII=');
            opacity: 0.1;
            pointer-events: none;
            mix-blend-mode: overlay;
        }

        /* 添加拍立得预览样式 */
        .polaroid-preview {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 12;
            display: none;
            cursor: pointer;
            font-family: "LCD", monospace;
        }

        /* 添加复古相机外观 */
        .camera-frame {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            background: #1a1a1a;
            border-radius: 10px;
            overflow: hidden;
        }

        .camera-screen {
            position: relative;
            width: 100%;
            height: calc(100% - 100px);
            background: #000;
            border: 2px solid #333;
            overflow: hidden;
        }

        .screen-corners::before,
        .screen-corners::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .screen-corners::before {
            top: 10px;
            left: 10px;
            border-right: none;
            border-bottom: none;
        }

        .screen-corners::after {
            bottom: 10px;
            right: 10px;
            border-left: none;
            border-top: none;
        }

        .camera-info {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 10px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            text-transform: uppercase;
        }

        .camera-info::before {
            content: 'FILM CAMERA';
            position: absolute;
            top: 10px;
            left: 10px;
        }

        .camera-info::after {
            content: 'ISO 100';
            position: absolute;
            top: 10px;
            right: 10px;
        }

        .polaroid-preview img {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            object-fit: contain;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            filter: brightness(0);
            animation: develop 8s ease-out forwards;
        }

        .preview-hint {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            opacity: 0;
            animation: fadeIn 0.5s ease-out 8s forwards;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        @keyframes shake {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            25% { transform: translate(-50%, -50%) rotate(-2deg); }
            75% { transform: translate(-50%, -50%) rotate(2deg); }
            100% { transform: translate(-50%, -50%) rotate(0deg); }
        }

        @keyframes develop {
            0% {
                filter: brightness(0) contrast(1.2);
            }
            10% {
                filter: brightness(0.1) contrast(1.2) sepia(0.4);
            }
            30% {
                filter: brightness(0.3) contrast(1.2) sepia(0.3);
            }
            50% {
                filter: brightness(0.5) contrast(1.2) sepia(0.2);
            }
            70% {
                filter: brightness(0.7) contrast(1.1) sepia(0.1);
            }
            90% {
                filter: brightness(0.9) contrast(1.05) sepia(0.05);
            }
            100% {
                filter: brightness(1) contrast(1) sepia(0);
            }
        }

        .filter-menu {
            display: flex;
            align-items: center;
            z-index: 5;
        }

        .filter-toggle {
            width: 40px;
            height: 40px;
            padding: 0 15px;
            min-width: 70px;
            background: #1a1a1a;
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            cursor: pointer;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .filter-toggle:active {
            background: #222;
            transform: scale(0.95);
        }

        .filter-panel {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            display: none;
            width: 300px;
            margin-bottom: 20px;
            max-height: 70vh;
            overflow-y: auto;
            bottom: 120%;
        }

        .filter-panel::-webkit-scrollbar {
            width: 6px;
        }

        .filter-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .filter-panel::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        .filter-panel::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .filter-panel.show {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        .filter-group {
            margin-bottom: 15px;
        }

        .filter-group h3 {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            margin-bottom: 8px;
            padding-left: 5px;
        }

        .filter-group .filter-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: 8px 12px;
            margin: 4px 0;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .filter-btn.active {
            background: rgba(255, 255, 255, 0.3);
            border-color: white;
        }

        .filter-btn-container {
            margin-bottom: 12px;
        }

        .filter-btn-container .filter-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: 8px 12px;
            margin: 0;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px 10px 0 0;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-desc {
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            padding: 6px 12px;
            margin: 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-top: none;
            border-radius: 0 0 10px 10px;
        }

        .filter-btn-container:hover .filter-btn {
            background: rgba(255, 255, 255, 0.2);
        }

        .filter-btn-container .filter-btn.active {
            background: rgba(255, 255, 255, 0.3);
            border-color: white;
        }

        .filter-btn-container .filter-btn.active + .filter-desc {
            border-color: white;
            color: white;
        }

        /* 调整面板宽度 */
        .filter-panel {
            width: 300px;
        }

        /* 添加新的徕卡滤镜样式 */
        .filter-leica-mono {
            filter: grayscale(1) contrast(1.3) brightness(0.95);
        }

        .filter-leica-chrome {
            filter: contrast(1.2) saturate(0.9) brightness(0.95) sepia(0.1);
        }

        .filter-leica-vivid {
            filter: contrast(1.25) saturate(1.1) brightness(0.9) hue-rotate(-5deg);
        }

        /* 添加新的滤镜样式 */
        .filter-polaroid {
            filter: contrast(1.2) brightness(1.1) saturate(0.9) sepia(0.15);
        }

        .filter-polaroid-600 {
            filter: contrast(1.3) brightness(1.05) saturate(1.1) sepia(0.2);
        }

        .lens-menu {
            display: flex;
            align-items: center;
            z-index: 5;
        }

        .lens-toggle {
            width: 40px;
            height: 40px;
            padding: 0 15px;
            min-width: 70px;
            background: #1a1a1a;
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            cursor: pointer;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .lens-toggle:active {
            background: #222;
            transform: scale(0.95);
        }

        .lens-panel {
            position: absolute;
            bottom: 100%;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            display: none;
            width: 300px;
            margin-bottom: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .lens-panel.show {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        /* 添加变焦相关样式 */
        .viewfinder {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: #000;
        }

        #camera-view {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform-origin: center center;
            transition: transform 0.3s ease-out;
        }

        /* 添加焦距指示器 */
        .focal-indicator {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 12px;
            backdrop-filter: blur(5px);
            z-index: 5;
            border: 1px solid rgba(255, 255, 255, 0.1);
            letter-spacing: 1px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* 添加对焦框样式 */
        .focus-frame {
            position: absolute;
            width: 70px;
            height: 70px;
            border: 1.5px solid rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
            z-index: 5;
            transform: translate(-50%, -50%);
        }

        .focus-frame::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 85px;
            height: 85px;
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }

        .focus-frame.focusing {
            opacity: 1;
            animation: focus-animation 0.3s ease-out;
        }

        @keyframes focus-animation {
            0% {
                transform: translate(-50%, -50%) scale(1.5);
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        /* 修改对焦成功动画 */
        .focus-frame.focused {
            border-color: rgba(255, 255, 255, 1);
        }

        .focus-frame.focused::before {
            border-color: rgba(255, 255, 255, 0.6);
        }

        /* 添加取景器扫描线效果 */
        .scan-line {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(to right,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.1) 50%,
                rgba(255, 255, 255, 0) 100%);
            animation: scan 2s linear infinite;
            opacity: 0.5;
            pointer-events: none;
        }

        @keyframes scan {
            from { transform: translateY(0); }
            to { transform: translateY(100%); }
        }

        /* 添加不同胶卷的相机UI主题 */
        .camera-container[data-film="kodak"] {
            background: #1a1a1a;
        }

        .camera-container[data-film="kodak"] .camera-status,
        .camera-container[data-film="kodak"] .controls {
            background: #141414;
        }

        .camera-container[data-film="kodak"] .camera-status {
            color: #ffd700;
        }

        /* 徕卡主题 */
        .camera-container[data-film="leica"] {
            background: #0a0a0a;
        }

        .camera-container[data-film="leica"] .camera-status,
        .camera-container[data-film="leica"] .controls {
            background: #0a0a0a;
            border-color: #1a1a1a;
        }

        .camera-container[data-film="leica"] .camera-status {
            color: #ff0000;
        }

        .camera-container[data-film="leica"] .viewfinder {
            border: 1px solid #1a1a1a;
            box-shadow: 0 2px 8px rgba(255, 0, 0, 0.1);
        }

        /* 富士主题 */
        .camera-container[data-film="fuji"] {
            background: #0d1a14;
        }

        .camera-container[data-film="fuji"] .camera-status,
        .camera-container[data-film="fuji"] .controls {
            background: #0a1410;
            border-color: #1f1f1f;
        }

        .camera-container[data-film="fuji"] .camera-status {
            color: #90EE90;
        }

        .camera-container[data-film="fuji"] .viewfinder {
            border: 1px solid #1f2f1f;
            box-shadow: 0 2px 8px rgba(144, 238, 144, 0.1);
        }

        /* 拍立得主题 */
        .camera-container[data-film="polaroid"] {
            background: #1a1614;
        }

        .camera-container[data-film="polaroid"] .camera-status,
        .camera-container[data-film="polaroid"] .controls {
            background: #141210;
            border-color: #2a2622;
        }

        .camera-container[data-film="polaroid"] .camera-status {
            color: #ffa500;
        }

        .camera-container[data-film="polaroid"] .viewfinder {
            border: 2px solid #2a2622;
            box-shadow: 0 2px 8px rgba(255, 165, 0, 0.1);
        }

        /* 统一按钮样式 */
        .camera-container[data-film] .shutter-btn {
            background: transparent;
            transition: all 0.3s ease;
        }

        .camera-container[data-film="kodak"] .shutter-btn {
            border-color: #ffd700;
        }

        .camera-container[data-film="leica"] .shutter-btn {
            border-color: #ff0000;
        }

        .camera-container[data-film="fuji"] .shutter-btn {
            border-color: #90EE90;
        }

        .camera-container[data-film="polaroid"] .shutter-btn {
            border-color: #ffa500;
        }

        /* 统一控制按钮样式 */
        .camera-container[data-film] .filter-toggle,
        .camera-container[data-film] .lens-toggle,
        .camera-container[data-film] .flip-btn {
            background: transparent;
            border-width: 1px;
            border-style: solid;
        }

        .camera-container[data-film="kodak"] .filter-toggle,
        .camera-container[data-film="kodak"] .lens-toggle,
        .camera-container[data-film="kodak"] .flip-btn {
            border-color: rgba(255, 215, 0, 0.3);
        }

        .camera-container[data-film="leica"] .filter-toggle,
        .camera-container[data-film="leica"] .lens-toggle,
        .camera-container[data-film="leica"] .flip-btn {
            border-color: rgba(255, 0, 0, 0.3);
        }

        .camera-container[data-film="fuji"] .filter-toggle,
        .camera-container[data-film="fuji"] .lens-toggle,
        .camera-container[data-film="fuji"] .flip-btn {
            border-color: rgba(144, 238, 144, 0.3);
        }

        .camera-container[data-film="polaroid"] .filter-toggle,
        .camera-container[data-film="polaroid"] .lens-toggle,
        .camera-container[data-film="polaroid"] .flip-btn {
            border-color: rgba(255, 165, 0, 0.3);
        }

        /* 添加新的滤镜效果 */
        .filter-kodak-ektar {
            filter: contrast(1.3) saturate(1.4) brightness(0.95) sepia(0.1);
        }

        .filter-kodak-trix {
            filter: grayscale(1) contrast(1.3) brightness(0.9);
        }

        .filter-fuji-velvia {
            filter: contrast(1.4) saturate(1.5) brightness(0.9) hue-rotate(-5deg);
        }

        .filter-fuji-provia {
            filter: contrast(1.2) saturate(1.1) brightness(1) hue-rotate(5deg);
        }

        .filter-kodak-gold {
            filter: contrast(1.1) saturate(1.2) brightness(1.05) sepia(0.2) hue-rotate(10deg);
        }

        .filter-fuji-c {
            filter: contrast(1.1) saturate(0.9) brightness(1.1) sepia(0.1) hue-rotate(-5deg);
        }

        /* 添加新的滤镜效果 */
        .filter-kodak-portra800 {
            filter: contrast(1.2) saturate(1.1) brightness(1.05) sepia(0.15) hue-rotate(5deg);
        }

        .filter-kodak-ultramax {
            filter: contrast(1.2) saturate(1.3) brightness(1) sepia(0.2) hue-rotate(5deg);
        }

        .filter-fuji-superia {
            filter: contrast(1.1) saturate(0.9) brightness(1.1) sepia(0.1) hue-rotate(-10deg);
        }

        .filter-fuji-natura {
            filter: contrast(1.3) saturate(0.8) brightness(1.2) sepia(0.1) hue-rotate(-5deg);
        }

        .filter-leica-vivid {
            filter: contrast(1.3) saturate(1.2) brightness(0.95);
        }

        /* 相册按钮样式 */
        .album-btn {
            width: 40px;
            height: 40px;
            background: #1a1a1a;
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            cursor: pointer;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.2s ease;
        }

        .album-btn:active {
            background: #222;
            transform: scale(0.95);
        }

        /* 相册预览界面样式 */
        .album-view {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            display: none;
            overflow-y: auto;
            padding: 20px;
        }

        .album-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 1001;
        }

        .album-title {
            color: white;
            font-size: 18px;
        }

        .album-close {
            color: white;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 10px;
        }

        .album-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            padding-top: 70px;
        }

        .album-item {
            position: relative;
            aspect-ratio: 1;
            cursor: pointer;
            border-radius: 8px;
            overflow: hidden;
        }

        .album-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .album-item:hover::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.1);
        }

        .album-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .album-clear {
            color: #ff4444;
            background: none;
            border: 1px solid #ff4444;
            border-radius: 15px;
            padding: 5px 15px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .album-clear:hover {
            background: rgba(255, 68, 68, 0.1);
        }

        /* 确认对话框样式 */
        .confirm-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            width: 300px;
            z-index: 1002;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .confirm-dialog h3 {
            color: white;
            margin: 0 0 15px 0;
            font-size: 16px;
        }

        .confirm-dialog .buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .confirm-dialog button {
            padding: 8px 20px;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .confirm-dialog .confirm-yes {
            background: #ff4444;
            color: white;
        }

        .confirm-dialog .confirm-no {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .confirm-dialog button:hover {
            transform: scale(1.05);
        }

        /* 添加新的滤镜效果 */
        .filter-polaroid-wide {
            filter: contrast(1.2) brightness(1.05) saturate(0.95) sepia(0.15);
        }

        + .filter-polaroid-portrait {
            filter: contrast(1.15) brightness(1.1) saturate(0.9) sepia(0.12);
        }
    </style>
</head>
<body>
    <div class="camera-container">
        <div class="camera-status">
            <div class="left-info">
                <span>⚡ OFF</span>
                <span>ISO 100</span>
            </div>
            <div class="right-info">
                <span>⟲</span>
                <span>35mm</span>
            </div>
        </div>
        <div class="camera-decoration"></div>
        <div class="viewfinder">
            <video id="camera-view" autoplay playsinline></video>
            <div class="grain-overlay"></div>
            <div class="scan-line"></div>
            <div class="camera-info">FILM CAMERA</div>
            <div class="camera-settings">ISO 100</div>
            <div class="focal-indicator">35mm</div>
            <div class="focus-frame"></div>
        </div>
        <div class="controls">
            <div class="camera-controls">
                <div class="filter-menu">
                    <button class="filter-toggle">PORTRA 400</button>
                    <div class="filter-panel">
                        <div class="filter-group">
                            <h3>柯达胶卷</h3>
                            <div class="filter-btn-container">
                                <button class="filter-btn active" data-type="kodak">Portra 400</button>
                                <p class="filter-desc">专业人像胶卷的标杆，完美的肤色和柔和的色调</p>
                            </div>
                            <div class="filter-btn-container">
                                <button class="filter-btn" data-type="kodak-gold">Gold 200</button>
                                <p class="filter-desc">日常用胶首选，温暖讨喜的色调，突出黄金色</p>
                            </div>
                            <div class="filter-btn-container">
                                <button class="filter-btn" data-type="kodak-ektar">Ektar 100</button>
                                <p class="filter-desc">超饱和色彩，适合风景和静物，锐利的细节表现</p>
                            </div>
                            <div class="filter-btn-container">
                                <button class="filter-btn" data-type="kodak-trix">Tri-X 400</button>
                                <p class="filter-desc">经典黑白胶卷，优秀的反差和颗粒感，街拍神器</p>
                            </div>
                            <div class="filter-btn-container">
                                <button class="filter-btn" data-type="kodak-portra800">Portra 800</button>
                                <p class="filter-desc">高感度人像胶卷，弱光环境的绝配，温暖细腻</p>
                            </div>
                            <div class="filter-btn-container">
                                <button class="filter-btn" data-type="kodak-ultramax">UltraMax 400</button>
                                <p class="filter-desc">平价日常胶卷，鲜艳讨喜，适合旅游纪实</p>
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <h3>拍立得</h3>
                            <div class="filter-btn-container">
                                <button class="filter-btn" data-type="polaroid">Polaroid SX-70</button>
                                <p class="filter-desc">经典拍立得，柔和明亮</p>
                            </div>
                            <div class="filter-btn-container">
                                <button class="filter-btn" data-type="polaroid-600">Polaroid 600</button>
                                <p class="filter-desc">高感度拍立得，鲜艳饱和</p>
                            </div>
                            <div class="filter-btn-container">
                                <button class="filter-btn" data-type="polaroid-wide">Polaroid Wide</button>
                                <p class="filter-desc">宽幅拍立得，3:2比例，更适合风景</p>
                            </div>
                            <div class="filter-btn-container">
                                <button class="filter-btn" data-type="polaroid-portrait">Polaroid Portrait</button>
                                <p class="filter-desc">竖版拍立得，2:3比例，适合人像</p>
                            </div>
                        </div>

                        <div class="filter-group">
                            <h3>富士胶卷</h3>
                            <div class="filter-btn-container">
                                <button class="filter-btn" data-type="fuji">Pro 400H</button>
                                <p class="filter-desc">专业负片，柔和细腻的色调，完美的肤色表现</p>
                            </div>
                            <div class="filter-btn-container">
                                <button class="filter-btn" data-type="fuji-c">C200</button>
                                <p class="filter-desc">经济实惠的日常用胶，清新自然的色彩</p>
                            </div>
                            <div class="filter-btn-container">
                                <button class="filter-btn" data-type="fuji-velvia">Velvia 50</button>
                                <p class="filter-desc">超高饱和度正片，适合风景，艳丽的色彩表现</p>
                            </div>
                            <div class="filter-btn-container">
                                <button class="filter-btn" data-type="fuji-provia">Provia 100F</button>
                                <p class="filter-desc">专业正片，自然的色彩平衡，优秀的细节表现</p>
                            </div>
                            <div class="filter-btn-container">
                                <button class="filter-btn" data-type="fuji-superia">Superia 400</button>
                                <p class="filter-desc">日系街拍最爱，独特的青色调，适合城市场景</p>
                            </div>
                            <div class="filter-btn-container">
                                <button class="filter-btn" data-type="fuji-natura">Natura 1600</button>
                                <p class="filter-desc">高感度夜拍胶卷，优秀的弱光表现，细腻的颗粒</p>
                            </div>
                        </div>
                    </div>
                </div>
                <button class="flip-btn">⟲</button>
                <button class="album-btn">□</button>
            </div>
            <button class="shutter-btn"></button>
            <div class="lens-menu">
                <button class="lens-toggle">35mm</button>
                <div class="lens-panel">
                    <div class="filter-group">
                        <h3>标准镜头</h3>
                        <div class="filter-btn-container">
                            <button class="filter-btn active" data-focal="35">35mm</button>
                            <p class="filter-desc">标准广角，适合街拍和日常</p>
                        </div>
                        <div class="filter-btn-container">
                            <button class="filter-btn" data-focal="50">50mm</button>
                            <p class="filter-desc">标准人像焦距，自然视角</p>
                        </div>
                    </div>
                    <div class="filter-group">
                        <h3>广角镜头</h3>
                        <div class="filter-btn-container">
                            <button class="filter-btn" data-focal="24">24mm</button>
                            <p class="filter-desc">广角视野，适合风景和建筑</p>
                        </div>
                        <div class="filter-btn-container">
                            <button class="filter-btn" data-focal="28">28mm</button>
                            <p class="filter-desc">经典广角，适合环境人像</p>
                        </div>
                    </div>
                    <div class="filter-group">
                        <h3>人像镜头</h3>
                        <div class="filter-btn-container">
                            <button class="filter-btn" data-focal="75">75mm</button>
                            <p class="filter-desc">中焦人像，适合半身像</p>
                        </div>
                        <div class="filter-btn-container">
                            <button class="filter-btn" data-focal="90">90mm</button>
                            <p class="filter-desc">经典人像焦距，适合特写</p>
                        </div>
                    </div>
                    <div class="filter-group">
                        <h3>长焦镜头</h3>
                        <div class="filter-btn-container">
                            <button class="filter-btn" data-focal="135">135mm</button>
                            <p class="filter-desc">经典长焦，压缩空间感</p>
                        </div>
                        <div class="filter-btn-container">
                            <button class="filter-btn" data-focal="200">200mm</button>
                            <p class="filter-desc">超长焦，强烈空间压缩</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="polaroid-preview" class="polaroid-preview"></div>

    <div class="filter-tooltip"></div>

    <div class="album-view">
        <div class="album-header">
            <div class="album-title">相册</div>
            <div class="album-actions">
                <div class="album-clear">清空相册</div>
                <button class="album-close">×</button>
            </div>
        </div>
        <div class="album-grid"></div>
    </div>

    <script>
        // 获取摄像头访问权限并显示预览
        async function initCamera() {
            try {
                const videoElement = document.getElementById('camera-view');
                // 获取设备支持的最大分辨率
                const constraints = {
                    video: {
                        facingMode: 'environment',
                        width: { ideal: 4096 },  // 请求最高分辨率
                        height: { ideal: 2160 }
                    },
                    audio: false
                };

                const stream = await navigator.mediaDevices.getUserMedia(constraints);

                // 获取视频轨道的能力
                const videoTrack = stream.getVideoTracks()[0];
                const capabilities = videoTrack.getCapabilities();
                
                // 设置最佳分辨率
                if (capabilities.width && capabilities.height) {
                    await videoTrack.applyConstraints({
                        width: { ideal: capabilities.width.max },
                        height: { ideal: capabilities.height.max }
                    });
                }

                videoElement.srcObject = stream;
            } catch (err) {
                console.error('访问相机失败:', err);
                alert('无法访问相机');
            }
        }

        // 添加滤镜控制功能
        function initFilters() {
            const filterToggle = document.querySelector('.filter-toggle');
            const filterPanel = document.querySelector('.filter-panel');
            const filterBtns = document.querySelectorAll('.filter-btn');
            const videoElement = document.getElementById('camera-view');
            const cameraContainer = document.querySelector('.camera-container');

            // 显示/隐藏滤镜面板
            filterToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                filterPanel.classList.toggle('show');
            });
            
            // 点击其他区域关闭面板
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.filter-menu')) {
                    filterPanel.classList.remove('show');
                }
            });

            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // 移除所有滤镜
                    filterBtns.forEach(b => b.classList.remove('active'));
                    videoElement.className = '';
                    
                    // 添加新滤镜
                    btn.classList.add('active');
                    const filterType = btn.dataset.type;
                    if (filterType) {
                        videoElement.classList.add(`filter-${filterType}`);
                        
                        // 更新相机UI主题
                        let theme = 'kodak'; // 默认主题
                        if (filterType.includes('leica')) {
                            theme = 'leica';
                        } else if (filterType.includes('fuji')) {
                            theme = 'fuji';
                        } else if (filterType.includes('polaroid')) {
                            theme = 'polaroid';
                        }
                        
                        cameraContainer.dataset.film = theme;
                        
                        // 更新状态栏信息
                        updateCameraInfo(filterType);
                        
                        // 更新胶卷按钮文字
                        filterToggle.textContent = btn.textContent;
                        
                        // 关闭面板
                        filterPanel.classList.remove('show');
                    }
                });
            });
        }

        function updateCameraInfo(filterType) {
            const leftInfo = document.querySelector('.camera-status .left-info');
            const filmInfo = {
                'leica-mono': 'LEICA M10 MONO',
                'leica-chrome': 'LEICA M10',
                'leica-vivid': 'LEICA M10-R',
                'kodak': 'PORTRA 400',
                'kodak-gold': 'GOLD 200',
                'kodak-ektar': 'EKTAR 100',
                'kodak-trix': 'TRI-X 400',
                'kodak-portra800': 'PORTRA 800',
                'kodak-ultramax': 'ULTRAMAX 400',
                'fuji': 'FUJIFILM PRO 400H',
                'fuji-c': 'FUJIFILM C200',
                'fuji-velvia': 'VELVIA 50',
                'fuji-provia': 'PROVIA 100F',
                'fuji-superia': 'SUPERIA 400',
                'fuji-natura': 'NATURA 1600',
                'polaroid': 'POLAROID SX-70',
                'polaroid-600': 'POLAROID 600'
            };
            
            leftInfo.innerHTML = `
                <span>⚡ OFF</span>
                <span>${filmInfo[filterType] || 'FILM'}</span>
            `;
        }

        // 修改 createPolaroid 函数
        function createPolaroid(imageData) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // 获取当前选中的胶卷名称和类型
                    const activeFilter = document.querySelector('.filter-btn.active');
                    const filmName = activeFilter ? activeFilter.textContent : 'MOCAM';
                    const filmType = activeFilter ? activeFilter.dataset.type : 'default';
                    
                    // 根据类型决定照片比例
                    let targetWidth = img.width;
                    let targetHeight = img.height;
                    
                    if (filmType === 'polaroid-wide') {
                        // 3:2 比例
                        if (img.width / img.height > 1.5) {
                            targetHeight = img.height;
                            targetWidth = img.height * 1.5;
                        } else {
                            targetWidth = img.width;
                            targetHeight = img.width / 1.5;
                        }
                    } else if (filmType === 'polaroid-portrait') {
                        // 2:3 竖版比例
                        if (img.height / img.width > 1.5) {
                            targetWidth = img.width;
                            targetHeight = img.width * 1.5;
                        } else {
                            targetHeight = img.height;
                            targetWidth = img.height / 1.5;
                        }
                    } else if (filmType.startsWith('polaroid')) {
                        // 标准拍立得接近正方形
                        const size = Math.min(img.width, img.height);
                        targetWidth = size;
                        targetHeight = size;
                    }
                    
                    // 计算裁切位置
                    const cropX = (img.width - targetWidth) / 2;
                    const cropY = (img.height - targetHeight) / 2;
                    
                    // 创建临时画布应用滤镜效果
                    const tempCanvas = document.createElement('canvas');
                    const tempCtx = tempCanvas.getContext('2d');
                    tempCanvas.width = targetWidth;
                    tempCanvas.height = targetHeight;
                    
                    // 先将图像绘制到临时画布
                    tempCtx.drawImage(img, cropX, cropY, targetWidth, targetHeight, 0, 0, targetWidth, targetHeight);
                    
                    // 应用滤镜效果
                    const imageData = tempCtx.getImageData(0, 0, targetWidth, targetHeight);
                    if (filmType === 'polaroid-wide') {
                        // 宽幅拍立得的滤镜效果
                        applyPolaroidWideFilter(imageData.data);
                    } else if (filmType === 'polaroid-portrait') {
                        // 竖版拍立得的滤镜效果
                        applyPolaroidPortraitFilter(imageData.data);
                    } else if (filmType.startsWith('polaroid')) {
                        applyNomoFilter(imageData.data);
                    }
                    tempCtx.putImageData(imageData, 0, 0);
                    
                    // 创建最终的拍立得效果
                    const borderWidth = Math.round(targetHeight * 0.08);
                    canvas.width = targetWidth + (borderWidth * 2);
                    canvas.height = targetHeight + borderWidth + Math.round(targetHeight * 0.3);
                    
                    // 绘制白色背景
                    ctx.fillStyle = '#fff';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // 绘制照片
                    ctx.drawImage(tempCanvas, borderWidth, borderWidth);
                    
                    // 添加日期和信息
                    const date = new Date().toLocaleDateString('zh-CN');
                    ctx.font = `${Math.round(borderWidth * 0.5)}px -apple-system`;
                    ctx.fillStyle = '#333';
                    ctx.textAlign = 'center';
                    ctx.fillText(`${filmName} · ${date}`, canvas.width / 2, canvas.height - borderWidth * 1.5);
                    
                    resolve(canvas.toDataURL('image/jpeg', 0.9));
                };
                img.src = imageData;
            });
        }

        // 添加宽幅拍立得的滤镜效果
        function applyPolaroidWideFilter(pixels) {
            for (let i = 0; i < pixels.length; i += 4) {
                // 调整色彩
                pixels[i] = Math.min(255, pixels[i] * 1.1);     // R
                pixels[i + 1] = Math.min(255, pixels[i + 1] * 1.05); // G
                pixels[i + 2] = Math.min(255, pixels[i + 2] * 1); // B

                // 添加轻微的复古效果
                const r = pixels[i];
                const g = pixels[i + 1];
                const b = pixels[i + 2];

                pixels[i] = Math.min(255, (r * 0.95 + g * 0.05 + b * 0.05));
                pixels[i + 1] = Math.min(255, (r * 0.05 + g * 0.95 + b * 0.05));
                pixels[i + 2] = Math.min(255, (r * 0.05 + g * 0.05 + b * 0.95));
            }
        }

        // 柯达风格边框
        function createKodakStyle(ctx, img, width, height, filmName) {
            const borderWidth = Math.round(height * 0.08); // 调整为适中的边框比例
            const canvas = ctx.canvas;
            
            canvas.width = width + (borderWidth * 2);
            canvas.height = height + (borderWidth * 2) + Math.round(height * 0.15); // 调整底部空间
            
            // 绘制黄色背景
            ctx.fillStyle = '#FFD700';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 绘制照片
            ctx.drawImage(img, borderWidth, borderWidth, width, height);
            
            // 绘制柯达 logo
            ctx.save();
            // 绘制红色背景块
            ctx.fillStyle = '#FF0000';
            const logoWidth = Math.round(width * 0.15);
            const logoHeight = Math.round(borderWidth * 0.8);
            ctx.fillRect(borderWidth * 0.5, borderWidth * 0.5, logoWidth, logoHeight);
            
            // 绘制白色文字
            ctx.font = `bold ${Math.round(logoHeight * 0.7)}px -apple-system`;
            ctx.fillStyle = '#FFFFFF';
            ctx.textAlign = 'center';
            ctx.fillText('KODAK', borderWidth * 0.5 + logoWidth * 0.5, borderWidth * 0.5 + logoHeight * 0.7);
            ctx.restore();
            
            // 添加日期和胶卷名称
            const date = new Date().toLocaleDateString('zh-CN');
            const videoElement = document.getElementById('camera-view');
            const focalLength = parseInt(videoElement.dataset.focalLength) || 35;
            ctx.font = `${Math.round(borderWidth * 0.5)}px -apple-system`;
            ctx.fillStyle = '#000';
            ctx.textAlign = 'right';
            ctx.fillText(`${filmName} · ${focalLength}mm · ${date}`, canvas.width - borderWidth * 0.7, canvas.height - borderWidth * 0.7);
        }

        // 徕卡风格边框
        function createLeicaStyle(ctx, img, width, height, filmName) {
            const borderWidth = Math.round(height * 0.07); // 调整为适中的边框比例
            const canvas = ctx.canvas;
            
            canvas.width = width + (borderWidth * 2);
            canvas.height = height + (borderWidth * 2) + Math.round(height * 0.12); // 调整底部空间
            
            // 绘制黑色背景
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 绘制照片
            ctx.drawImage(img, borderWidth, borderWidth, width, height);
            
            // 绘制徕卡 logo
            ctx.save();
            // 绘制红点
            ctx.beginPath();
            ctx.fillStyle = '#FF0000';
            const dotRadius = Math.round(borderWidth * 0.3);
            ctx.arc(borderWidth * 0.8, borderWidth * 0.8, dotRadius, 0, Math.PI * 2);
            ctx.fill();
            
            // 绘制品牌文字
            ctx.font = `bold ${Math.round(borderWidth * 0.7)}px -apple-system`;
            ctx.fillStyle = '#FF0000';
            ctx.textAlign = 'left';
            ctx.fillText('LEICA', borderWidth * 1.5, borderWidth * 0.9);
            ctx.restore();
            
            // 添加日期和胶卷名称
            const date = new Date().toLocaleDateString('zh-CN');
            const videoElement = document.getElementById('camera-view');
            const focalLength = parseInt(videoElement.dataset.focalLength) || 35;
            ctx.font = `${Math.round(borderWidth * 0.5)}px -apple-system`;
            ctx.fillStyle = '#FFF';
            ctx.textAlign = 'right';
            ctx.fillText(`${filmName} · ${focalLength}mm · ${date}`, canvas.width - borderWidth * 0.6, canvas.height - borderWidth * 0.6);
        }

        // 富士风格边框
        function createFujiStyle(ctx, img, width, height, filmName) {
            const borderWidth = Math.round(height * 0.075); // 调整为适中的边框比例
            const canvas = ctx.canvas;
            
            canvas.width = width + (borderWidth * 2);
            canvas.height = height + (borderWidth * 2) + Math.round(height * 0.13); // 调整底部空间
            
            // 绘制渐变背景
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#90EE90');
            gradient.addColorStop(1, '#98FB98');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 绘制照片
            ctx.drawImage(img, borderWidth, borderWidth, width, height);
            
            // 绘制富士 logo
            ctx.save();
            // 绘制品牌文字
            ctx.font = `bold ${Math.round(borderWidth * 0.8)}px -apple-system`;
            ctx.fillStyle = '#006400';
            ctx.textAlign = 'left';
            ctx.fillText('FUJIFILM', borderWidth * 0.8, borderWidth * 1.2);
            
            // 绘制装饰线
            ctx.strokeStyle = '#006400';
            ctx.lineWidth = Math.round(borderWidth * 0.08);
            ctx.beginPath();
            ctx.moveTo(borderWidth * 0.8, borderWidth * 1.4);
            ctx.lineTo(borderWidth * 3, borderWidth * 1.4);
            ctx.stroke();
            ctx.restore();
            
            // 添加日期和胶卷名称
            const date = new Date().toLocaleDateString('zh-CN');
            const videoElement = document.getElementById('camera-view');
            const focalLength = parseInt(videoElement.dataset.focalLength) || 35;
            ctx.font = `${Math.round(borderWidth * 0.6)}px -apple-system`;
            ctx.fillStyle = '#006400';
            ctx.textAlign = 'center';
            ctx.fillText(`${filmName} · ${focalLength}mm · ${date}`, canvas.width / 2, canvas.height - borderWidth * 0.8);
        }

        // 默认样式
        function createDefaultStyle(ctx, img, width, height, filmName) {
            const borderWidth = 15;
            const canvas = ctx.canvas;
            
            canvas.width = width + (borderWidth * 2);
            canvas.height = height + (borderWidth * 2) + 30;
            
            // 绘制白色背景
            ctx.fillStyle = '#FFF';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 绘制照片
            ctx.drawImage(img, borderWidth, borderWidth, width, height);
            
            // 添加文字
            const date = new Date().toLocaleDateString('zh-CN');
            ctx.font = '14px -apple-system';
            ctx.fillStyle = '#333';
            ctx.textAlign = 'right';
            ctx.fillText(`${filmName} · ${date}`, canvas.width - 10, canvas.height - 10);
        }

        // 修改 showPolaroidPreview 函数
        function showPolaroidPreview(polaroidImage) {
            const preview = document.getElementById('polaroid-preview');
            preview.innerHTML = `
                <div class="camera-frame">
                    <div class="camera-info"></div>
                    <div class="camera-screen">
                        <div class="screen-corners"></div>
                        <img src="${polaroidImage}" style="cursor: pointer;">
                    </div>
                    <div class="preview-hint">点击照片保存 · 点击其他区域继续拍摄</div>
                </div>
            `;
            preview.style.display = 'block';
            preview.dataset.developing = 'true';

            const img = preview.querySelector('img');
            img.style.animation = 'shake 0.5s ease-out, develop 8s ease-out forwards';

            return new Promise(resolve => {
                img.addEventListener('animationend', (e) => {
                    if (e.animationName === 'develop') {
                        preview.dataset.developing = 'false';
                        resolve();
                    }
                });
            });
        }

        // 在初始化函数中添加以下代码

        function initAlbum() {
            const albumBtn = document.querySelector('.album-btn');
            const albumView = document.querySelector('.album-view');
            const albumClose = document.querySelector('.album-close');
            const albumGrid = document.querySelector('.album-grid');
            const albumClear = document.querySelector('.album-clear');
            
            // 从 localStorage 获取保存的照片
            function getStoredPhotos() {
                const photos = localStorage.getItem('mocam_photos');
                return photos ? JSON.parse(photos) : [];
            }
            
            // 保存照片到 localStorage
            function storePhoto(photoData) {
                try {
                    const photos = getStoredPhotos();
                    photos.push({
                        data: photoData,
                        timestamp: Date.now()
                    });
                    // 检查数据大小
                    const dataSize = JSON.stringify(photos).length;
                    if (dataSize > 4.5 * 1024 * 1024) { // 接近 localStorage 5MB 限制
                        // 只保留最新的 10 张照片
                        photos.splice(0, photos.length - 10);
                    }
                    localStorage.setItem('mocam_photos', JSON.stringify(photos));
                    return true;
                } catch (err) {
                    console.error('存储照片失败:', err);
                    // 如果是存储空间不足，尝试清理旧照片
                    if (err.name === 'QuotaExceededError') {
                        const photos = getStoredPhotos();
                        photos.splice(0, photos.length - 5); // 只保留最新的 5 张
                        localStorage.setItem('mocam_photos', JSON.stringify(photos));
                        // 重试保存当前照片
                        return storePhoto(photoData);
                    }
                    return false;
                }
            }
            
            // 渲染相册
            function renderAlbum() {
                const photos = getStoredPhotos();
                albumGrid.innerHTML = photos.map((photo, index) => `
                    <div class="album-item" data-index="${index}">
                        <img src="${photo.data}" alt="Photo ${index + 1}">
                    </div>
                `).join('');
            }
            
            // 显示相册
            albumBtn.addEventListener('click', () => {
                albumView.style.display = 'block';
                renderAlbum();
            });
            
            // 关闭相册
            albumClose.addEventListener('click', () => {
                albumView.style.display = 'none';
            });
            
            // 点击照片下载
            albumGrid.addEventListener('click', (e) => {
                const item = e.target.closest('.album-item');
                if (item) {
                    const index = parseInt(item.dataset.index);
                    const photos = getStoredPhotos();
                    const photo = photos[index];
                    
                    const link = document.createElement('a');
                    link.download = `MOCAM_${photo.timestamp}.jpg`;
                    link.href = photo.data;
                    link.click();
                }
            });
            
            // 显示确认对话框
            function showConfirmDialog(message, onConfirm) {
                const dialog = document.createElement('div');
                dialog.className = 'confirm-dialog';
                dialog.innerHTML = `
                    <h3>${message}</h3>
                    <div class="buttons">
                        <button class="confirm-no">取消</button>
                        <button class="confirm-yes">确定</button>
                    </div>
                `;

                document.body.appendChild(dialog);

                dialog.querySelector('.confirm-yes').addEventListener('click', () => {
                    onConfirm();
                    dialog.remove();
                });

                dialog.querySelector('.confirm-no').addEventListener('click', () => {
                    dialog.remove();
                });
            }

            // 清除所有照片
            function clearPhotos() {
                localStorage.removeItem('mocam_photos');
                renderAlbum();
            }

            // 添加清除按钮事件
            albumClear.addEventListener('click', () => {
                showConfirmDialog('确定要清空所有照片吗？', clearPhotos);
            });

            return { storePhoto };
        }

        // 修改初始化函数中的相关代码
        window.addEventListener('load', () => {
            async function init() {
                try {
                    await initCamera();
                    initFilters();
                    initCameraFlip();
                    initLensSelector();
                    initFocusFrame();
                    const { storePhoto } = initAlbum(); // 初始化相册功能
                    
                    const shutterBtn = document.querySelector('.shutter-btn');
                    const videoElement = document.getElementById('camera-view');
                    
                    // 修改拍照事件处理函数
                    shutterBtn.addEventListener('click', async function handleCapture() {
                        shutterBtn.disabled = true;
                        try {
                            const canvas = document.createElement('canvas');
                            const context = canvas.getContext('2d');
                            
                            // 获取当前变焦比例
                            const focalLength = parseInt(videoElement.dataset.focalLength) || 35;
                            const zoomRatio = focalLength / 35;
                            
                            // 设置较大的画布尺寸以保持图像质量
                            const baseWidth = videoElement.videoWidth;
                            const baseHeight = videoElement.videoHeight;
                            canvas.width = baseWidth;
                            canvas.height = baseHeight;
                            
                            // 先将完整视频帧绘制到画布上
                            context.drawImage(videoElement, 0, 0, baseWidth, baseHeight);
                            
                            // 创建临时画布进行裁切
                            const tempCanvas = document.createElement('canvas');
                            const tempContext = tempCanvas.getContext('2d');
                            
                            // 计算裁切区域，保持原始宽高比
                            const cropWidth = baseWidth / zoomRatio;
                            const cropHeight = baseHeight / zoomRatio;
                            const cropX = (baseWidth - cropWidth) / 2;
                            const cropY = (baseHeight - cropHeight) / 2;
                            
                            // 设置临时画布尺寸为裁切后的大小
                            tempCanvas.width = cropWidth;
                            tempCanvas.height = cropHeight;
                            
                            // 将裁切区域复制到临时画布
                            tempContext.drawImage(canvas,
                                cropX, cropY, cropWidth, cropHeight,
                                0, 0, cropWidth, cropHeight
                            );
                            
                            try {
                                // 获取当前选中的滤镜
                                const activeFilter = document.querySelector('.filter-btn.active');
                                const filterType = activeFilter ? activeFilter.dataset.type : null;
                                
                                // 获取原始图像数据
                                const imageData = tempCanvas.toDataURL('image/jpeg', 0.9);
                                
                                // 创建拍立得效果
                                const polaroidImage = await createPolaroid(imageData);
                                
                                // 保存处理后的照片
                                storePhoto(polaroidImage);
                                
                                // 显示简短的拍照动画或提示
                                const flash = document.createElement('div');
                                flash.style.cssText = `
                                    position: fixed;
                                    top: 0;
                                    left: 0;
                                    right: 0;
                                    bottom: 0;
                                    background: white;
                                    opacity: 0;
                                    z-index: 1000;
                                    pointer-events: none;
                                    animation: flash 0.3s ease-out;
                                `;
                                document.body.appendChild(flash);
                                setTimeout(() => flash.remove(), 300);
                                
                            } catch (err) {
                                console.error('处理照片时出错:', err);
                                throw err;
                            }
                            
                        } catch (err) {
                            console.error('保存照片时出错:', err);
                            alert('保存照片失败');
                        } finally {
                            shutterBtn.disabled = false;
                        }
                    });
                    
                } catch (err) {
                    console.error('初始化失败:', err);
                    alert('相机初始化失败');
                }
            }
            init();
        });

        // 添加闪光动画样式
        const style = document.createElement('style');
        style.textContent = `
            @keyframes flash {
                0% { opacity: 0.8; }
                100% { opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // 滤镜效果函数
        function applyNomoFilter(pixels) {
            for (let i = 0; i < pixels.length; i += 4) {
                // 增加对比度和饱和度
                pixels[i] = pixels[i] * 1.1;     // R
                pixels[i + 1] = pixels[i + 1] * 1.1; // G
                pixels[i + 2] = pixels[i + 2] * 1.1; // B

                // 添加复古效果
                const r = pixels[i];
                const g = pixels[i + 1];
                const b = pixels[i + 2];

                pixels[i] = Math.min(255, (r * 0.9 + g * 0.1 + b * 0.1));
                pixels[i + 1] = Math.min(255, (r * 0.07 + g * 0.9 + b * 0.07));
                pixels[i + 2] = Math.min(255, (r * 0.05 + g * 0.05 + b * 0.9));
            }
        }

        function applyFilmFilter(pixels) {
            for (let i = 0; i < pixels.length; i += 4) {
                // 降低饱和度，增加对比度
                const r = pixels[i];
                const g = pixels[i + 1];
                const b = pixels[i + 2];

                const avg = (r + g + b) / 3;
                pixels[i] = Math.min(255, avg + (r - avg) * 0.8);
                pixels[i + 1] = Math.min(255, avg + (g - avg) * 0.8);
                pixels[i + 2] = Math.min(255, avg + (b - avg) * 0.8);

                // 添加暖色调
                pixels[i] = Math.min(255, pixels[i] * 1.1);
                pixels[i + 1] = Math.min(255, pixels[i + 1] * 1.05);
            }
        }

        function applyBWFilter(pixels) {
            for (let i = 0; i < pixels.length; i += 4) {
                const r = pixels[i];
                const g = pixels[i + 1];
                const b = pixels[i + 2];

                // 转换为黑白并增加对比度
                const bw = (r * 0.3 + g * 0.59 + b * 0.11);
                const contrast = Math.min(255, (bw - 128) * 1.2 + 128);

                pixels[i] = contrast;
                pixels[i + 1] = contrast;
                pixels[i + 2] = contrast;
            }
        }

        function applyVintageFilter(pixels) {
            for (let i = 0; i < pixels.length; i += 4) {
                const r = pixels[i];
                const g = pixels[i + 1];
                const b = pixels[i + 2];

                // 复古效果
                pixels[i] = Math.min(255, (r * 0.9 + g * 0.2 + b * 0.1));
                pixels[i + 1] = Math.min(255, (r * 0.2 + g * 0.8 + b * 0.1));
                pixels[i + 2] = Math.min(255, (r * 0.1 + g * 0.1 + b * 0.9));
            }
        }

        function applyChromeFilter(pixels) {
            for (let i = 0; i < pixels.length; i += 4) {
                // 增加对比度和饱和度
                pixels[i] = Math.min(255, pixels[i] * 1.3);     // R
                pixels[i + 1] = Math.min(255, pixels[i + 1] * 1.2); // G
                pixels[i + 2] = Math.min(255, pixels[i + 2] * 1.1); // B
            }
        }

        // 添加反转镜头功能
        function initCameraFlip() {
            const flipBtn = document.querySelector('.flip-btn');
            let facingMode = 'environment';

            flipBtn.addEventListener('click', async () => {
                facingMode = facingMode === 'environment' ? 'user' : 'environment';
                
                try {
                    const videoElement = document.getElementById('camera-view');
                    const stream = videoElement.srcObject;
                    if (stream) {
                        stream.getTracks().forEach(track => track.stop());
                    }

                    // 使用高分辨率约束
                    const constraints = {
                        video: {
                            facingMode: facingMode,
                            width: { ideal: 4096 },
                            height: { ideal: 2160 }
                        },
                        audio: false
                    };

                    const newStream = await navigator.mediaDevices.getUserMedia(constraints);
                    
                    // 设置最佳分辨率
                    const videoTrack = newStream.getVideoTracks()[0];
                    const capabilities = videoTrack.getCapabilities();
                    if (capabilities.width && capabilities.height) {
                        await videoTrack.applyConstraints({
                            width: { ideal: capabilities.width.max },
                            height: { ideal: capabilities.height.max }
                        });
                    }
                    
                    videoElement.srcObject = newStream;
                } catch (err) {
                    console.error('切换摄像头失败:', err);
                    alert('切换摄像头失败');
                }
            });
        }

        // 添加徕卡滤镜处理函数
        function applyLeicaMonoFilter(pixels) {
            for (let i = 0; i < pixels.length; i += 4) {
                const r = pixels[i];
                const g = pixels[i + 1];
                const b = pixels[i + 2];

                // 高质量黑白转换
                const mono = r * 0.2126 + g * 0.7152 + b * 0.0722;
                // 增加对比度和层次
                const contrast = Math.min(255, (mono - 128) * 1.3 + 128);

                pixels[i] = contrast;
                pixels[i + 1] = contrast;
                pixels[i + 2] = contrast;
            }
        }

        // 添加 createPolaroidStyle 函数
        function createPolaroidStyle(ctx, img, width, height, filmName, cropX, cropY) {
            // 调整为真实拍立得的比例
            const borderTop = Math.round(height * 0.08);    // 减小顶部边框
            const borderSide = Math.round(width * 0.08);    // 减小侧边边框
            const borderBottom = Math.round(height * 0.15); // 减小底部边框
            const canvas = ctx.canvas;
            
            // 设置画布尺寸
            canvas.width = width + (borderSide * 2);
            canvas.height = height + borderTop + borderBottom;
            
            // 绘制白色背景
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 绘制 Polaroid logo
            ctx.save();
            const logoSize = Math.round(borderTop * 0.4);
            ctx.font = `bold ${logoSize}px -apple-system`;
            ctx.fillStyle = '#999';
            ctx.textAlign = 'left';
            ctx.fillText('POLAROID', borderSide * 0.5, borderTop * 0.4);
            
            // 添加彩虹装饰条
            const colors = ['#ff0000', '#ff7f00', '#ffff00', '#00ff00', '#0000ff', '#4b0082', '#8b00ff'];
            const stripeWidth = Math.round(borderSide * 0.15);
            const stripeHeight = Math.round(borderTop * 0.25);
            colors.forEach((color, i) => {
                ctx.fillStyle = color;
                ctx.fillRect(
                    borderSide + (i * stripeWidth), 
                    borderTop * 0.6,
                    stripeWidth, 
                    stripeHeight
                );
            });
            ctx.restore();
            
            // 添加阴影效果
            ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
            ctx.shadowBlur = 15;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 5;
            
            // 绘制照片
            ctx.drawImage(img, cropX, cropY, width, height, borderSide, borderTop, width, height);
            
            // 重置阴影
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            
            // 添加日期和胶卷名称
            const date = new Date().toLocaleDateString('zh-CN');
            ctx.textAlign = 'center';
            const titleSize = Math.round(borderBottom * 0.35); // 调整标题大小
            ctx.font = `bold ${titleSize}px -apple-system`;
            ctx.fillStyle = '#333';
            ctx.fillText(filmName, canvas.width / 2, height + borderTop + (borderBottom * 0.5));
            
            const dateSize = Math.round(borderBottom * 0.2); // 调整日期大小
            ctx.font = `${dateSize}px -apple-system`;
            ctx.fillStyle = '#666';
            ctx.fillText(date, canvas.width / 2, height + borderTop + (borderBottom * 0.8));
        }

        function initLensSelector() {
            const lensToggle = document.querySelector('.lens-toggle');
            const lensPanel = document.querySelector('.lens-panel');
            const lensButtons = document.querySelectorAll('.lens-panel .filter-btn');
            const videoElement = document.getElementById('camera-view');
            const focalIndicator = document.querySelector('.focal-indicator');
            
            // 基准焦距（35mm相当于1倍变焦）
            const BASE_FOCAL = 35;
            let currentZoom = 1;
            
            // 显示/隐藏镜头面板
            lensToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                lensPanel.classList.toggle('show');
            });
            
            // 点击其他区域关闭面板
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.lens-menu')) {
                    lensPanel.classList.remove('show');
                }
            });
            
            // 应用变焦效果
            function applyZoom(focalLength) {
                const zoomRatio = focalLength / BASE_FOCAL;
                currentZoom = Math.max(1, zoomRatio);
                
                // 应用变焦效果
                videoElement.style.transform = `scale(${currentZoom})`;
                
                // 更新焦距指示器
                focalIndicator.textContent = `${focalLength}mm`;
                
                // 存储当前焦距，用于拍照时的裁切
                videoElement.dataset.focalLength = focalLength;
            }
            
            // 选择镜头
            lensButtons.forEach(button => {
                button.addEventListener('click', () => {
                    lensButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    
                    // 获取焦距并应用变焦
                    const focalLength = parseInt(button.dataset.focal);
                    applyZoom(focalLength);
                    
                    // 更新当前镜头显示
                    lensToggle.textContent = `${focalLength}mm`;
                    
                    // 关闭面板
                    lensPanel.classList.remove('show');
                });
            });
            
            // 初始化默认焦距
            applyZoom(BASE_FOCAL);
        }

        function initFocusFrame() {
            const viewfinder = document.querySelector('.viewfinder');
            const focusFrame = document.querySelector('.focus-frame');
            let focusTimeout;

            viewfinder.addEventListener('click', (e) => {
                // 忽略控制按钮的点击
                if (e.target.closest('.controls')) {
                    return;
                }

                // 获取点击位置
                const rect = viewfinder.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                // 更新对焦框位置
                focusFrame.style.left = `${x}px`;
                focusFrame.style.top = `${y}px`;

                // 清除之前的动画类和定时器
                focusFrame.classList.remove('focusing', 'focused');
                clearTimeout(focusTimeout);

                // 重置动画
                void focusFrame.offsetWidth; // 触发重排，重置动画

                // 添加对焦动画
                focusFrame.classList.add('focusing');

                // 模拟对焦过程
                setTimeout(() => {
                    focusFrame.classList.add('focused');
                    
                    // 2秒后隐藏对焦框
                    focusTimeout = setTimeout(() => {
                        focusFrame.style.opacity = '0';
                        setTimeout(() => {
                            focusFrame.classList.remove('focusing', 'focused');
                        }, 300);
                    }, 2000);
                }, 300);

                // 如果设备支持，尝试进行实际对焦
                const videoTrack = document.getElementById('camera-view').srcObject?.getVideoTracks()[0];
                if (videoTrack?.getCapabilities?.().focusMode) {
                    try {
                        videoTrack.applyConstraints({
                            advanced: [{
                                focusMode: 'manual',
                                focusDistance: 0
                            }]
                        });
                    } catch (err) {
                        console.log('Manual focus not supported');
                    }
                }
            });
        }

        // 添加竖版拍立得的滤镜效果
        function applyPolaroidPortraitFilter(pixels) {
            for (let i = 0; i < pixels.length; i += 4) {
                // 调整色彩
                pixels[i] = Math.min(255, pixels[i] * 1.05);     // R
                pixels[i + 1] = Math.min(255, pixels[i + 1] * 1.1); // G
                pixels[i + 2] = Math.min(255, pixels[i + 2] * 1.02); // B

                // 添加柔和的复古效果
                const r = pixels[i];
                const g = pixels[i + 1];
                const b = pixels[i + 2];

                pixels[i] = Math.min(255, (r * 0.93 + g * 0.05 + b * 0.02));
                pixels[i + 1] = Math.min(255, (r * 0.02 + g * 0.93 + b * 0.05));
                pixels[i + 2] = Math.min(255, (r * 0.02 + g * 0.05 + b * 0.93));
            }
        }
    </script>
</body>
</html> 